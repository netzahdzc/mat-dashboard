#!/usr/bin/env python
import sys
import shutil
import os.path
import time
import logging
import re
import hashlib
import os


from scipy import signal
import numpy as np
# Below command allows printing long sequence list
np.set_printoptions(threshold=np.nan)
#import matplotlib.pyplot as plt

if __name__ == "__main__":    
    ## Generate a noisy signal to be filtered:
    #t = np.linspace(0, 1, 937)
    #x = (np.sin(2*np.pi*0.75*t*(1-t) + 2.1) + 0.1*np.sin(2*np.pi*1.25*t + 1) + 0.18*np.cos(2*np.pi*3.85*t))
    #xn = x + np.random.randn(len(t)) * 0.08
    xn = sys.argv[1].split(",")
    xn = list(map(float, xn))
    #xn = [-3.234423161,-0.419761658,-0.31836319,-0.319313049,-0.309393883,-0.30867672,-0.317221642,-0.315524101,-0.322834969,-0.30668354,-0.309000969,-0.302343369,-0.312994003,-0.315925598,-0.318349838,-0.328500748,-0.329837799,-0.338978767,-0.321136475,-0.308605194,-0.274477959,-0.255402565,-0.274145126,-0.278017998,-0.273702621,-0.286787033,-0.290988922,-0.283914566,-0.240891457,-0.20098877,-0.155986786,-0.140040398,-0.112184525,-0.092806816,-0.065523148,-0.07480526,-0.044231415,-0.035259247,0.002290726,0.066728592,0.134820938,0.19739151,0.257855415,0.263503075,0.277493477,0.280485153,0.253172874,0.243283272,0.270998955,0.316241264,0.355456352,0.381988525,0.395338058,0.401177406,0.403435707,0.42502594,0.455341339,0.469578743,0.462316513,0.372440338,0.318356514,0.26331234,0.159732819,0.101371765,0.098959923,0.047679901,0.025673866,0.001490593,-0.035400391,-0.061359406,0.014985085,0.134021759,0.323014259,0.438352585,0.477934837,0.554415703,0.670456886,0.785346985,0.981144905,1.173339844,1.424628258,1.470686913,1.417366028,1.242741585,1.053957939,1.016456604,1.016456604,0.74518013,0.3724823,-0.059914112,-0.400331974,-0.687002182,-0.841396809,-0.897079945,-0.893176079,-0.792342663,-0.643404484,-0.513930321,-0.419007301,-0.284600258,-0.111933231,-0.014883041,0.081336021,0.163465023,0.188503742,0.2043643,0.208888054,0.190460682,0.18877697,0.184906483,0.175891876,0.138179779,0.065582275,-0.065311909,-0.19020319,-0.289572239,-0.39225769,-0.474579334,-0.480876923,-0.429512501,-0.413064957,-0.454163074,-0.455578804,-0.476304054,-0.529045582,-0.636394501,-0.752818584,-0.854893684,-0.96711874,-1.042243004,-1.13457489,-1.136909485,-1.192372799,-1.233886719,-1.351857185,-1.418617725,-1.499620914,-1.605138302,-1.776294708,-1.956234932,-2.110107422,-2.211309433,-2.290860176,-2.379490852,-2.448359966,-2.473095894,-2.505457401,-2.513219833,-2.499528885,-2.494764805,-2.519790649,-2.543192863,-2.447049618,-2.294425488,-2.160616398,-2.092709064,-1.96194315,-1.808869362,-1.760813713,-1.731069088,-1.6682477,-1.45637989,-1.189791679,-0.743032455,-0.212244034,0.231886864,0.608456612,0.78745842,0.841299057,0.767814636,0.546452522,0.296403885,0.016242981,-0.329380989,-0.534851074,-0.606534004,-0.717657089,-0.824679375,-0.887760162,-0.989508629,-1.000276566,-1.016937256,-1.011113167,-0.927788734,-0.716817856,-0.512771606,-0.365346909,-0.294924736,-0.218682289,-0.054564476,0.050351143,0.123796463,0.158960342,0.222311974,0.291039467,0.224514961,0.106491089,-0.050188065,-0.122638702,-0.066269875,0.160989761,0.642690659,1.291563034,1.96396637,2.657436371,2.888877869,2.767386436,2.35783577,1.573173523,0.563402176,-0.186800003,-0.407264709,-0.407264709,-0.398797035,-0.51993084,-0.906559944,-1.076102257,-0.876172066,-0.54810524,-0.289504051,-0.097784996,-0.015739441,0.016023636,0.053929329,0.027032852,-0.040466309,-0.149950981,-0.319164276,-0.506391525,-0.774320602,-1.058389664,-1.297370911,-1.572675705,-1.73763752,-1.877129078,-1.91356802,-1.915580273,-1.885270119,-1.823998451,-1.752083778,-1.783337593,-1.723361969,-1.637684822,-1.532119751,-1.354647636,-1.09644413,-0.830557823,-0.751131058,-0.834086418,-0.875144958,-0.682732582,-0.312430382,0.001455307,0.239771843,0.415518761,0.637788773,1.097243309,1.524464607,1.772737503,1.921443939,2.009197235,2.175357819,2.432630539,2.788575172,2.760783195,2.105967522,1.745464325,1.762952805,1.444768906,0.877189636,0.248311043,-0.591610909,-1.421274185,-1.871879578,-1.706319809,-1.353479385,-0.963851929,-0.57994175,-0.242446899,-0.003693581,0.228105545,0.425127029,0.55050087,0.43211937,0.158824921,-0.081254005,-0.353717804,-0.687470436,-1.020663261,-1.380319595,-1.614199638,-1.812733173,-1.946378231,-2.076389313,-2.1875,-2.285568237,-2.383947372,-2.399321556,-2.365999222,-2.297016621,-2.244026661,-2.210552216,-2.242975712,-2.285437107,-2.225281239,-2.08570385,-1.904607773,-1.638661385,-1.224042892,-0.740521431,-0.174496651,0.315331459,0.716172218,0.932249069,0.919712067,0.789784431,0.660244942,0.562372208,0.517702103,0.471425056,0.776031494,1.645915985,2.707549095,3.835144043,4.503207207,4.176501274,2.921397209,1.556177139,0.501156807,-0.243611336,-0.931893349,-1.307180405,-1.191161156,-0.896104813,-0.675842285,-0.336526871,0.153791428,0.654103279,0.947065353,1.125274658,1.030338287,1.030338287,0.615100861,-0.189489365,-0.8540411,-1.17930603,-1.464378357,-1.738077164,-1.967277527,-2.162323475,-2.319182396,-2.448427677,-2.429750919,-2.411054611,-2.349040508,-2.290220737,-2.243733883,-2.173125744,-2.105217934,-1.821849823,-1.412590981,-1.084724426,-1.12173748,-1.321471214,-1.383328438,-1.238548279,-0.939426422,-0.513771057,-0.053099632,0.432697296,0.839073181,1.195419312,1.391202927,1.386613846,1.222975731,0.966862679,0.9564991,1.560846329,2.575118065,3.130040169,2.956139565,2.704752922,2.801989555,2.421638489,1.347453117,0.102870941,-0.776988029,-1.076889992,-0.728777885,-0.280161858,-0.205770493,-0.062338829,0.225255966,0.520558357,0.747425079,0.792060852,0.589718819,0.127676964,-0.34223938,-0.66354084,-0.971204758,-1.343236923,-1.628454208,-1.90960741,-2.128937721,-2.22326088,-2.277797222,-2.347260952,-2.364873886,-2.411306858,-2.384979248,-2.337403774,-2.30696106,-2.243974209,-2.182663441,-2.212181091,-2.281759262,-2.320152283,-2.197966576,-1.988239765,-1.729886055,-1.378193855,-0.807786942,-0.098228455,0.58165741,1.055868149,1.256592751,1.197415352,0.970292091,0.732320786,0.659293175,0.950888634,1.532129288,2.428103447,3.257867813,3.688207626,3.649834633,3.376223564,2.674523354,1.746382713,0.740606308,-0.096716881,-0.50176239,-0.409402847,-0.277643204,-0.405193329,-0.384864807,-0.08603096,0.196992874,0.368282318,0.380789757,0.284960747,0.095395088,-0.40398407,-0.91651535,-1.231887817,-1.459819794,-1.653236389,-1.880417824,-2.142243862,-2.426316261,-2.662409306,-2.793005943,-2.812378883,-2.75022316,-2.599231243,-2.408075333,-2.210474014,-2.210474014,-1.985309601,-1.759933472,-1.430776596,-1.269767761,-1.250483513,-1.318346977,-1.360625267,-1.274954796,-0.992061615,-0.557527542,-0.10559082,0.247047424,0.527467728,0.78327179,0.973631859,1.096785545,1.104761124,1.164837837,1.778591156,3.154823303,4.211249352,4.062749863,3.365473747,3.169629097,2.860654831,1.749975204,0.195243835,-1.024069786,-1.407822609,-1.047850609,-0.476148605,-0.232006073,-0.11869812,0.026203156,0.281974792,0.483185768,0.562063217,0.493954659,0.349445343,0.136097908,-0.160456657,-0.426695824,-0.696315765,-1.025837898,-1.347106934,-1.581355095,-1.726453781,-1.811392784,-1.905348301,-2.024631977,-2.163788795,-2.281089306,-2.413073063,-2.570637226,-2.610640526,-2.517597675,-2.398452282,-2.321065426,-2.358403206,-2.396298409,-2.39956665,-2.325093746,-2.154129982,-1.830504417,-1.322944641,-0.693856239,0.040000916,0.669848442,1.116803169,1.339765549,1.224833488,0.938240051,0.81133461,0.975123405,1.517683029,2.254554749,2.983586311,3.788327217,4.380563736,4.354001999,3.499018669,2.150127411,0.869236946,-0.03629303,-0.468716621,-0.483201981,-0.41194725,-0.512363434,-0.429504395,-0.203868866,0.110520363,0.248810768,0.20279789,0.240708351,0.286198616,0.095103264,-0.455071449,-0.929335594,-1.254981995,-1.529743195,-1.776007652,-2.146602631,-2.444817543,-2.640281677,-2.671083927,-2.726409912,-2.795610905,-2.825302124,-2.843263149,-2.624120712,-2.467551708,-2.203001976,-1.912676811,-1.654255867,-1.470799446,-1.494974136,-1.58966732,-1.495896339,-1.08182621,-0.435266495,0.262696266,0.744339943,0.990037918,1.15297699,1.252096176,1.236160278,1.082924843,1.082924843,0.946585655,0.95249939,1.212774277,1.96987915,2.959354401,3.245295525,2.750281334,2.478307724,2.343211174,1.547290802,0.247649193,-0.841081619,-1.302872658,-0.972599983,-0.347824097,0.005931854,0.183959961,0.401278496,0.660038948,0.960412979,1.114544868,1.088632584,0.878048897,0.578848839,0.187080383,-0.232867241,-0.608829498,-1.067475319,-1.536930084,-1.905754566,-2.207486629,-2.398875237,-2.560859203,-2.699203014,-2.778892994,-2.81821394,-2.763041973,-2.636303902,-2.488752842,-2.279248238,-2.106716633,-2.02828598,-2.077183247,-2.248737812,-2.319162369,-2.258511543,-2.124199867,-1.896720886,-1.446827888,-0.846061707,-0.143634796,0.462532997,0.986369133,1.379107475,1.431768417,1.256201744,1.204536438,1.517981529,2.210596085,3.16437912,3.87053299,4.024905205,3.721298218,3.459450722,2.664367676,1.393531799,0.20071125,-0.380156517,-0.28460598,0.034723282,-0.014453888,-0.090847969,0.026099205,0.249079704,0.42564106,0.274530411,0.056568146,-0.026988983,0.082749367,-0.080312729,-0.45372963,-0.86737442,-1.240019798,-1.493050575,-1.715698242,-1.986825943,-2.220186234,-2.335456848,-2.341096878,-2.3398633,-2.278768539,-2.094664574,-1.905245304,-1.819030762,-1.755815506,-1.622303963,-1.536540031,-1.693439484,-2.010233879,-2.268883705,-2.397933483,-2.395209789,-2.266093254,-2.054075718,-1.660970688,-1.026619911,-0.257627487,0.36857605,0.647340775,0.65191555,0.528271675,0.496665955,0.45139122,0.551134109,0.995976448,1.969590187,2.819934845,3.289023399,3.613280296,3.875199318,4.056978226,3.340136528,1.678003311,-0.083418846,-0.977840424,-1.058673859,-1.058673859,-0.78787899,-0.415616989,-0.077663422,0.267451286,0.413174629,0.41201973,0.003482819,-0.367570877,-0.417690277,-0.139627457,0.193651199,0.422856331,0.477341652,0.350336075,0.105940819,-0.267307281,-0.613713264,-0.861416817,-0.986429214,-1.118570328,-1.224162102,-1.317445755,-1.455360413,-1.589596748,-1.691401482,-1.742865562,-1.743935585,-1.733028412,-1.651971817,-1.572171211,-1.544384003,-1.528118134,-1.507677078,-1.486762047,-1.526316643,-1.590482712,-1.676182747,-1.708073616,-1.601138115,-1.366135597,-1.056846619,-0.816950798,-0.594338417,-0.355610847,-0.055825233,0.212768555,0.409520149,0.350686073,0.07522583,-0.064873695,0.117185593,0.675180435,1.28284359,1.499020576,1.571517944,1.847593307,2.257884979,2.308419228,1.761656761,1.386073112,1.814415932,1.878663063,1.39016819,0.537020683,-0.031250954,-0.122425079,-0.045557022,0.001912117,-0.182957649,-0.404222488,-0.452431679,-0.438241959,-0.43651104,-0.362812042,-0.279309273,-0.279508591,-0.427898407,-0.605027199,-0.734591484,-0.804905891,-0.807095528,-0.804998398,-0.767526627,-0.772013664,-0.873478889,-1.013010979,-1.106171608,-1.134485245,-0.986169815,-0.928758621,-0.942685127,-0.964853287,-0.968623161,-0.969047546,-1.002652168,-1.005931854,-1.065087318,-1.126070023,-1.140676498,-1.051659584,-0.839597702,-0.610568047,-0.4476614,-0.303876877,-0.236442566,-0.174322128,-0.080756187,0.145438194,0.382019043,0.604217529,0.517491341,0.233056068,-0.062228203,-0.272801399,-0.400032997,-0.4734869,0.494102478,0.494102478,0.060030937,-0.260582924,-0.412635803,-0.518199921,-0.629917145,-0.76464653,-0.837837219,-0.816112518,-0.678329468,-0.513899803,-0.397379875,-0.339278221,-0.353590012,-0.364143372,-0.454298019,-0.677217484,-0.863078117,-0.922574043,-0.893523216,-0.810516357,-0.784964561,-0.836561203,-0.70618248,-0.493743896,-0.350099564,-0.205842018,-0.193861008,-0.23035717,-0.120771408,0.124711037,0.418119431,0.706148148,0.843342781,0.819586754,0.543324471,-0.004559517,-0.696271896,-0.561042786,-0.433641434,-0.321889877,-0.250322342,-0.199298859,-0.219532013,-0.348350525,-0.45857048,-0.588766098,-0.722418785,-0.779034615,-0.726563454,-0.65504837,-0.560587883,-0.51953125,-0.466918945,-0.394719124,-0.200896263,0.048965454,0.284657478,0.456764221,0.615859985,0.811977386,1.057972908,1.355358124,1.624124527,1.828120232,2.003419876,1.890093803,1.685910225,1.588792801,1.406672478,1.04312706,0.537691116,-0.047464371,-0.649922371,-1.214666367,-1.357427597,-1.375609398,-1.406417847,-1.373781204,-1.286200523,-1.128074646,-0.952626228,-0.682606697,-0.312620163,0.107596397,0.463163376,0.640239716,0.713247299,0.694023132,0.635469437,0.615855217,0.668236732,1.004426956,1.658495903,2.368121147,2.962603569,3.212971687,3.124587059,2.791244507,2.287296295,1.614089012,0.732125282,0.109084129,0.080551147,0.300737381,0.118278503,-0.200124741,-0.356581688,-0.184376717,-0.078271866,-0.248601913,-0.351062775,-0.397372246,1.728208542,1.804154396,1.591598511,1.559236526,2.195521355,3.311288834,4.27974987,4.596391678,3.993124962,3.07639122,2.520688057,1.770115852,0.840517044,0.04934597,-0.324382782,-0.55782795,-0.893826485,-0.967880249,-0.631430626,-0.138315201,0.115501404,0.225191116,0.231043816,0.139540672,0.167261124,-0.060536385,-0.5984478,-1.044836044,-1.385969162,-1.673857689,-1.962353706,-2.268754482,-2.596670151,-2.844895363,-2.909893036,-2.833999634,-2.701768398,-2.557836533,3.164391518,2.717100143,1.501307487,0.259231567,-0.342344284,-0.251962662,-0.12389946,-0.335170746,-0.420619011,-0.165818214,0.145419121,0.179292679,0.18564415,0.200480461,0.059370995,-0.408176422,-0.871746063,-1.13789463,-1.311410904,-1.418578148,-1.537826538,-1.786352158,-2.085132122,-2.338342667,-2.501745701,-2.5968256,-2.653581142,-2.691651821,-2.736896515,-2.678407192,-2.521724701,-2.314404964,-2.081337452,-1.916090965,-1.827131271,-1.873493671,-2.002515793,-2.02502346,0.172758102,0.089309692,-0.000135422,-0.158482552,-0.461200714,-0.81337738,-1.157081604,-1.450701714,-1.725226402,-1.941643238,-2.059175014,-2.135124207,-2.183453083,-2.214134216,-2.26098299,-2.25788784,-2.260940075,-2.178159714,-2.069867611,-1.997877121,-2.030434132,-2.069153786,-2.176085949,-2.305119514,-2.380656242,-2.288350582,-2.011061668,-1.52152729,-0.881902695,-0.227153778,0.327535629,0.783685684,1.116539955,1.176888466,0.964167595,0.664439201,0.537590027,0.729039192,-2.420568466,-2.302908421,-2.114463806,-1.958503246,-1.813873291,-1.648249626,-1.581223488,-1.563136101,-1.593379974,-1.568914413,-1.508641243,-1.439953804,-1.339328766,-1.100998878,-0.770673752,-0.403274536,0.065338135,0.527098656,0.899433136,1.014485359,0.989636421,0.790697098,0.680672646,0.829555511,1.442399979,2.316728592,2.985354424,3.041241646,2.615803719,2.498707771,2.369075775,1.551691055,0.237120628,-0.657739639,-0.537742615,-0.15585041,-0.012198448,0.0823946,0.376177788,0.464127541,0.438257217,0.380052567,0.355874062,0.231855392,0.204212189,0.447896957,1.037063599,1.886157036,2.690469742,3.318299294,3.494931221,3.323905945,2.820845604,1.87014389,0.952025414,0.11356926,-0.631734848,-1.13349247,-1.263949394,-0.842558861,-0.502678871,-0.306501389,-0.185988426,0.226691246,0.669834137,0.593755722,0.567536354,0.653648376,0.83339119,0.885770798,0.521003723,-0.052092552,-0.412054062,-0.620586395,-0.789470673,-1.022369385,1.503311157,0.541394234,0.280768394,0.148344994,-0.145468712,-0.495972633,-0.794258118,-0.967764854,-1.005296707,-0.987939835,-0.89384079,-0.714731216,-0.509334564,-0.311208725,-0.104510307,-0.094563484,-0.17499733,-0.27863121,-0.40670681,-0.545305252,-0.704559326,-0.817912102,-0.849482536,-0.803948402,-0.719835281,-0.634039879,-0.557033539,-0.490356445,-0.46544075,-0.450846672,-0.433806419,-0.341062546,-0.270960808,-0.21889019,-0.216496468,-0.214682579,-0.202558517,-0.221142769,-0.380337715,-0.380337715,-0.3751688,-0.417920113,-0.479688644,-0.476058006,-0.384011269,-0.1491642,0.139237404,0.435941696,0.656182289,0.840722084,0.903187752,0.796142578,0.546479225,0.315900803,0.112159729,-0.092701912,-0.220659256,-0.343652725,-0.469044685]
    
    ## Create an order 3 lowpass butterworth filter:
    b, a = signal.butter(3, 0.10)

    ## Apply the filter to xn. Use lfilter_zi to choose the initial condition of the filter:
    zi = signal.lfilter_zi(b, a)
    z, _ = signal.lfilter(b, a, xn, zi=zi*xn[0])

    ## Apply the filter again, to have a result filtered at an order the same as filtfilt:
    z2, _ = signal.lfilter(b, a, z, zi=zi*z[0])

    ## Use filtfilt to apply the filter:
    y = signal.filtfilt(b, a, xn)

    print(y)

    ## Plot the original signal and the various filtered versions:
    #plt.figure
    #plt.plot(t, xn, 'b', alpha=0.75)
    #plt.plot(t, y, 'k')
    #plt.legend(('noisy signal', 'filtered'), loc='best')
    #plt.grid(True)
    #plt.show()

# https://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.signal.butter.html
# https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.lfilter.html#scipy.signal.lfilter
# https://en.wikipedia.org/wiki/Butterworth_filter
# http://dsp.stackexchange.com/questions/19084/applying-filter-in-scipy-signal-use-lfilter-or-filtfilt